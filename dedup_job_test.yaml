name: deduplicate-documents-test-1tb
image_uri: anyscale/ray:2.50.0-py312-cu128
compute_config:
  cloud: anyscale_gcp_public_default_cloud_us_west_1
  head_node:
    instance_type: n2-standard-64
  worker_nodes:
    # - instance_type: n2-highmem-64
    #   min_nodes: 20
    #   max_nodes: 100
    - instance_type: n2-highmem-80
      min_nodes: 30
      max_nodes: 100
    - instance_type: n2-highmem-96
      min_nodes: 20
      max_nodes: 100
working_dir: .
env_vars:
  RAY_BACKEND_LOG_LEVEL: debug
  RAY_DEFAULT_OBJECT_STORE_MEMORY_PROPORTION: '0.5'
  RAY_DATA_CLUSTER_AUTOSCALER: RAYTURBO_LEGACY
ray_version: 2.50.0
entrypoint: |
  python ray_data_dedup.py \
    --input=gs://anyscale-example-datasets/HuggingFaceFW/fineweb-edu/data/ \
    --text-column=text \
    --id-column=id \
    --threshold=0.7 \
    --num-perm=128 \
    --ngram-size=5 \
    --max-cc-iterations=100 \
    --limit=1000000000 \
    --parallelism=300 \
    --disable-progress-bars
max_retries: 0
job_queue_config:
  priority: 100
  job_queue_spec:
    name: dedup-cluster-memlarge
    idle_timeout_s: 1200
